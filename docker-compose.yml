version: "3.9"

x-common: &common
  env_file: .env
  restart: on-failure         # 🔄 reinicia contenedor si la API falla
  networks: [ingest_net]

services:
  ms1_ingest:
    <<: *common
    build:
      context: .                 # ← raíz del repo, no ms1
      dockerfile: ingestion/ms1/Dockerfile
    volumes:
      - ./ingestion/data/ms1:/app/data
    depends_on: []            # si algún día llamas a otro contenedor

  ms2_ingest:
    <<: *common
    build: ./ingestion/ms2
    volumes:
      - ./ingestion/data/ms2:/app/data

  ms3_ingest:
    <<: *common
    build: ./ingestion/ms3
    volumes:
      - ./ingestion/data/ms3:/app/data

networks:
  ingest_net:
    driver: bridge

